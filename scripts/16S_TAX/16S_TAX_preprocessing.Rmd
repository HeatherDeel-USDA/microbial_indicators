---
title: "Random Forest, 16S taxonomic data"
author: "Heather Deel"
date: "2023-09-12"
output: html_document
---

### Setup and packages
```{r setup, include=FALSE}
library(tidyverse)
library(phyloseq)
```

### Load and format data
```{r}
# load Dan's phyloseq object created in SHAI_Data_Processing.Rmd
P.total <- readRDS("dan_files/P.Soils.16S.species.Total.RDS")

# export otu table from phyloseq
OTU1 = as(otu_table(P.total), "matrix")
OTU1 <- data.frame(OTU1)
OTU1$PLFA_ID <- rownames(OTU1)

# upload current metadata
data.sampleID <- read.delim('metadata/SHAI.Meta.22March2023.q2.reduced.txt', sep = '\t')
data.pred.SHMI <- readRDS('metadata/data.pred.SHMI.RDS')
data.merged <- merge(data.pred.SHMI, data.sampleID, by = "PLFA_ID", all.x = TRUE)

# merge OTU table with current metadata
ml_TAX_16S <- merge(data.merged, OTU1, by = "PLFA_ID", all.x = TRUE)

# get rid of NAs - going to assume they are 0
ml_TAX_16S[is.na(ml_TAX_16S)] <- 0

# save
saveRDS(ml_TAX_16S, file = "machine_learning/16S_TAX/ml_TAX_16S.RDS")
```


